# プロジェクト構成と開発ワークフローガイド

このドキュメントは、現在のNext.jsプロジェクトのフォルダ構成と、今後の運用・開発における具体的なワークフローについて解説するものである。

## 1. フォルダ構成と各ファイルの役割

### ルートディレクトリ
-   **`next.config.js`**: Next.jsの動作をカスタマイズする設定ファイル。APIプロキシ（リライト）などの設定が記述されている。
-   **`codegen.ts`**: GraphQL Code Generatorの設定ファイル。どのGraphQLサーバー（`schema`）から、どのクエリ（`documents`）を基に、どこに（`generates`）TypeScriptの型を生成するかを定義している。
-   **`tsconfig.json`**: TypeScriptコンパイラの設定ファイル。`@/`のような絶対パスでのインポート（パスエイリアス）を可能にする `baseUrl` と `paths` の設定が重要。
-   **`package.json`**: プロジェクト情報、依存パッケージの一覧、そして `pnpm run dev` や `pnpm run build` のようなコマンド（スクリプト）を定義する。
-   **`docs/`**: このプロジェクトに関する仕様書や手順書などのドキュメントを格納するディレクトリ。

### `src/app/` (ルーティングとページ)
Next.jsのApp Router規約に基づき、**ディレクトリ構造がそのままURLのパスになる**のが特徴。

-   **`layout.tsx`**: サイト全体の共通レイアウト（`<html>`, `<body>`タグ、共通のヘッダー・フッターなど）を定義する。グローバルなCSSはここでインポートする。
-   **`page.tsx`**: トップページ（`/`）の本体。データ取得と表示用コンポーネントへの受け渡しを行う。
-   **`blog/[slug]/page.tsx`**: ブログ記事詳細ページの動的ルート。URLの `[slug]` の部分をパラメータとして受け取り、対応する記事データを取得して表示する。
-   **`api/`**: サーバーサイドで動作するAPIルート。
    -   `preview/route.ts`: WordPressのプレビュー機能を実装するためのAPI。

### `src/components/` (再利用可能なUI部品)
-   **`Globals/`**: サイト全体で使われる共通コンポーネント（ヘッダー、フッターなど）。
-   **`Templates/`**: 各ページの主要な表示内容を受け持つ、骨格となるコンポーネント。ページからデータを受け取り、具体的なHTML構造を生成する。

### `src/queries/` (GraphQLクエリ)
GraphQLクエリを一元管理するディレクトリ。`.graphql` ファイルとしてクエリを記述することで、コードとデータ取得ロジックを分離している。

### `src/gql/` (自動生成される型定義)
GraphQL Code Generatorによって**自動生成される**ディレクトリ。**このディレクトリ内のファイルは絶対に手動で編集してはならない。**

### `src/utils/` (ヘルパー関数)
-   **`fetchGraphQL.ts`**: **サーバーサイド**でGraphQL APIからデータを取得するための共通関数。
-   **`fetchGraphQL-client.ts`**: **クライアントサイド**（ブラウザ）でGraphQL APIからデータを取得するための共通関数。

---

## 2. ユースケース別・開発ワークフロー

### ケース1：ブログ記事を新規投稿する（日常的なコンテンツ更新）

1.  **WordPressにログイン**: `http://35.224.211.72/wp-login.php` にアクセスしてログインする。
2.  **記事作成**: 「投稿」>「新規追加」で記事のタイトル、本文、アイキャッチ画像などを入力する。
3.  **カテゴリー設定**:
    -   通常のブログ記事なら「Uncategorized」または新しく作成した「Blog」カテゴリーを選択する。
    -   ポートフォリオとして表示したい作品なら「Portfolio」カテゴリーを選択する。
4.  **公開**: 「公開」ボタンをクリックする。
5.  **自動反映**: これだけで作業は完了。Vercel上のサイト (`https://www.cloud-palette.com`) には、数分以内に新しい記事が自動的に反映される（ISR機能）。フロントエンドのコードを触る必要も、再デプロイする必要もない。

### ケース2：トップページの「Services」セクションの文言を変更する

1.  **WordPressにログイン**: `http://35.224.211.72/wp-login.php` にアクセスする。
2.  **固定ページ編集**: 「固定ページ」一覧から `Home` というページを探し、編集画面を開く。
3.  **本文を編集**: 本文エディタ内の「Services」に関する部分のテキストを修正する。
4.  **更新**: 「更新」ボタンをクリックする。
5.  **自動反映**: Vercel上のトップページが、数分以内に新しい文言で自動的に更新される。

### ケース3：サイトのデザイン（例: ボタンの色）を変更する

1.  **ローカルで開発サーバーを起動**:
    ```bash
    pnpm run dev
    ```
2.  **CSSを編集**: `src/app/lp-style.css` を開き、該当するボタンのCSSクラス（例: `.contact-button`）の `background-color` などを変更する。
3.  **ブラウザで確認**: `http://localhost:3000` を開き、デザインが意図通りに変更されたかを確認する。
4.  **デプロイ**:
    ```bash
    git add .
    git commit -m "style: Change button color"
    git push
    ```
5.  **本番環境に反映**: Vercelが自動的にビルドとデプロイを行い、数分後に本番サイトのデザインが更新される。

### ケース4：新しいページ（例: 「料金」ページ）を追加する

1.  **WordPressで固定ページを作成**:
    -   管理画面で「固定ページ」>「新規追加」を選択。
    -   タイトルに `料金` と入力し、パーマリンクのスラッグが `pricing` などになるように設定する。
    -   本文に料金表などのコンテンツを入力し、「公開」する。
2.  **フロントエンドで確認**: これだけで、`https://www.cloud-palette.com/pricing` に新しいページが自動的に生成される。
    -   （`src/app/[...slug]/page.tsx` がこのURLを検知してページを動的に生成するため）

### ケース5：新しい機能（例: ポートフォリオに動画を追加）を実装する

1.  **WordPress側 (ACF)**:
    -   「カスタムフィールド」で、ポートフォリオ用の投稿に「動画URL」というフィールドを追加し、GraphQLで公開する設定を行う。
2.  **フロントエンド側 (ローカル)**:
    -   `src/queries/portfolio/Portfolios.graphql` などのクエリを修正し、「動画URL」フィールドを取得するようにする。
    -   `pnpm run codegen` を実行して型を再生成する。
    -   `PortfolioDetailTemplate.tsx` などのコンポーネントを修正し、取得した動画URLを使って埋め込み動画を表示するロジックを追加する。
3.  **デプロイ**: 修正が完了したら `git push` して本番環境に反映させる。