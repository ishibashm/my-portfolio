# ヘッドレスCMS実装計画書

## 1. 現状分析と課題

### 1.1. 実装済み機能

- ✅ WordPress GraphQL API連携基盤
- ✅ GraphQL Code Generatorによる型安全なクエリ生成
- ✅ プレビューモード機能
- ✅ 動的ルーティング (`/blog/[slug]`, `/portfolio/[slug]`)
- ✅ SEOメタデータ管理の基本機能
- ✅ ブログ記事一覧・詳細・カテゴリ別一覧機能
- ✅ ポートフォリオ一覧・詳細機能
- ✅ 環境変数設定 (`NEXT_PUBLIC_WORDPRESS_API_URL`)

### 1.2. プロジェクトの現状課題

`docs/WordPressヘッドレスCMS実装方法リサーチ.md` および現状の実装を踏まえると、以下の課題が浮き彫りになります。

1.  **コンテンツ管理の分断**: 現在の実装は「ブログ」と「ポートフォリオ」という特定のコンテンツタイプに特化しており、**ホームページや一般的な固定ページ（例：「私について」「お問い合わせ」など）が静的なままで、WordPressから管理できていません。** これではヘッドレスCMSの利点である「一元的なコンテンツ管理」が実現できているとは言えません。
2.  **既存ページの柔軟性の欠如**: `src/app/[...slug]/page.tsx` で処理される汎用ページや、既存の投稿(`Post`)タイプに対するデータ取得が最小限であり、ACF（Advanced Custom Fields）などによる柔軟なコンテンツ拡張に対応できていません。
3.  **最適化とデプロイ戦略の未定義**: パフォーマンス最適化（特に画像最適化）や、Vercelへのデプロイ設定、キャッシュ戦略（ISRなど）が具体的に実装されておらず、本番運用にはリスクが残ります。

## 2. ヘッドレスCMS実装完了の定義

以下の機能がすべて実装された状態を「ヘッドレスCMS実装の完成」と定義します。

- **一元的なコンテンツ管理**: WordPress管理画面から、サイト上のほぼ全てのテキスト、画像コンテンツを編集・更新できる。
- **完全な動的ルーティング**: WordPressで作成した固定ページが、フロントエンドで自動的にページとして生成・表示される。
- **柔軟なコンテンツ表現**: ACFを活用し、各ページや投稿に独自のコンテンツブロック（例：CTAボタン、画像ギャラリー）を追加・表示できる。
- **堅牢な運用体制**:
    - **プレビュー機能**: コンテンツ編集者が公開前に変更内容を安全に確認できる。
    - **オンデマンド再生成**: WordPressでのコンテンツ更新後、Vercel上の該当ページが自動的に再生成（ISR）され、常に最新の状態が保たれる。
    - **パフォーマンス**: Lighthouseスコアで高得点を維持し、高速なページ表示を実現する。

## 3. 実装タスク一覧

上記の完成形に至るため、以下のタスクを順に実行します。

### フェーズ1: ホームページの完全動的化

ホームページのコンテンツをWordPressから取得し、動的に表示します。

- **`src/queries/home/HomePageQuery.ts`**: ホームページに必要なコンテンツ（ヒーローセクション、お知らせ、ポートフォリオへの導線など）を取得するGraphQLクエリを作成します。
- **`src/app/page.tsx`**: 上記クエリを使用してデータを取得し、`HomePageTemplate`に渡します。
- **`src/components/Templates/HomePage/HomePageTemplate.tsx`**: 取得したデータを基にホームページのUIを構築します。

### フェーズ2: 既存ページの拡張と柔軟性向上

汎用的な固定ページと投稿ページを、より詳細かつ柔軟なコンテンツに対応させます。

- **`src/components/Templates/Page/PageQuery.ts`**: 固定ページ取得クエリを拡張し、ACFで追加されたフィールドを取得できるようにします。
- **`src/components/Templates/Post/PostQuery.ts`**: 投稿ページ取得クエリを拡張し、同様にACFフィールドを取得可能にします。
- **`src/app/[...slug]/page.tsx`**: `PageQuery`を使い、WordPressで作成された固定ページを動的に表示するロジックを強化します。
- **`src/app/blog/[slug]/page.tsx`**: `PostQuery`を使い、投稿詳細ページの表示をリッチにします。

### フェーズ3: 最適化と本番環境準備

パフォーマンスを最適化し、Vercelでの本番運用設定を完了させます。

1.  **画像最適化**: Next.jsの`<Image>`コンポーネントを適切に設定し、WordPressからの画像配信を最適化します。
2.  **ISR (Incremental Static Regeneration) の設定**: `revalidate`オプションを各ページに設定し、オンデマンドでの再生成を有効化します。
3.  **Vercelデプロイ設定**: Vercelプロジェクトを作成し、GitHubリポジトリと連携。環境変数を設定し、自動デプロイを構成します。
4.  **プレビュー機能の最終確認**: Vercelのプレビュー環境で、`draftMode()`が正しく機能することを確認します。

## 4. WordPress側の準備事項

- **ホームページ用コンテンツの作成**: WordPressの「設定 > 表示設定」で特定の固定ページを「ホームページ」として指定し、そのページにACFでコンテンツフィールドを追加します。
- **ACFフィールドグループの作成**: 固定ページや投稿用に、再利用可能なコンテンツブロック（例：リッチテキスト、画像、CTA）のフィールドグループを作成し、「GraphQLに表示」を有効にします。
- **コンテンツの入力**: 作成したフィールドに実際のコンテンツを入力します。